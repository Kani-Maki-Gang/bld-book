<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Bld book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="getting_started.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">2.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="pipelines/preface.html"><strong aria-hidden="true">3.</strong> Pipelines</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pipelines/version.html"><strong aria-hidden="true">3.1.</strong> Version</a></li><li class="chapter-item expanded "><a href="pipelines/name.html"><strong aria-hidden="true">3.2.</strong> Name</a></li><li class="chapter-item expanded "><a href="pipelines/runs_on.html"><strong aria-hidden="true">3.3.</strong> Runs on</a></li><li class="chapter-item expanded "><a href="pipelines/cron.html"><strong aria-hidden="true">3.4.</strong> Cron</a></li><li class="chapter-item expanded "><a href="pipelines/dispose.html"><strong aria-hidden="true">3.5.</strong> Dispose</a></li><li class="chapter-item expanded "><a href="pipelines/variables.html"><strong aria-hidden="true">3.6.</strong> Variables</a></li><li class="chapter-item expanded "><a href="pipelines/environment.html"><strong aria-hidden="true">3.7.</strong> Envrironment</a></li><li class="chapter-item expanded "><a href="pipelines/keywords.html"><strong aria-hidden="true">3.8.</strong> Keywords</a></li><li class="chapter-item expanded "><a href="pipelines/artifacts.html"><strong aria-hidden="true">3.9.</strong> Artifacts</a></li><li class="chapter-item expanded "><a href="pipelines/external.html"><strong aria-hidden="true">3.10.</strong> External</a></li><li class="chapter-item expanded "><a href="pipelines/jobs_and_steps.html"><strong aria-hidden="true">3.11.</strong> Jobs and steps</a></li><li class="chapter-item expanded "><a href="pipelines/validation.html"><strong aria-hidden="true">3.12.</strong> Validation</a></li></ol></li><li class="chapter-item expanded "><a href="server/preface.html"><strong aria-hidden="true">4.</strong> Server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="server/running_a_server.html"><strong aria-hidden="true">4.1.</strong> Running a server</a></li><li class="chapter-item expanded "><a href="server/database.html"><strong aria-hidden="true">4.2.</strong> Database</a></li><li class="chapter-item expanded "><a href="server/authorization.html"><strong aria-hidden="true">4.3.</strong> Authorization</a></li><li class="chapter-item expanded "><a href="server/tls.html"><strong aria-hidden="true">4.4.</strong> TLS</a></li><li class="chapter-item expanded "><a href="server/ssh.html"><strong aria-hidden="true">4.5.</strong> SSH</a></li><li class="chapter-item expanded "><a href="server/ui/preface.html"><strong aria-hidden="true">4.6.</strong> User interface</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="server/ui/login.html"><strong aria-hidden="true">4.6.1.</strong> Login</a></li><li class="chapter-item expanded "><a href="server/ui/dashboard.html"><strong aria-hidden="true">4.6.2.</strong> Dashboard</a></li><li class="chapter-item expanded "><a href="server/ui/history.html"><strong aria-hidden="true">4.6.3.</strong> History</a></li><li class="chapter-item expanded "><a href="server/ui/monitor.html"><strong aria-hidden="true">4.6.4.</strong> Monitor</a></li><li class="chapter-item expanded "><a href="server/ui/pipelines.html"><strong aria-hidden="true">4.6.5.</strong> Pipelines</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="server/ui/pipelines_info.html"><strong aria-hidden="true">4.6.5.1.</strong> Info</a></li><li class="chapter-item expanded "><a href="server/ui/pipelines_run.html"><strong aria-hidden="true">4.6.5.2.</strong> Run</a></li></ol></li><li class="chapter-item expanded "><a href="server/ui/cron.html"><strong aria-hidden="true">4.6.6.</strong> Cron jobs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="server/ui/cron_info.html"><strong aria-hidden="true">4.6.6.1.</strong> Info</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="github-action.html"><strong aria-hidden="true">5.</strong> Github action</a></li><li class="chapter-item expanded "><a href="cli/preface.html"><strong aria-hidden="true">6.</strong> Command line interface</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/cat.html"><strong aria-hidden="true">6.1.</strong> Cat</a></li><li class="chapter-item expanded "><a href="cli/check.html"><strong aria-hidden="true">6.2.</strong> Check</a></li><li class="chapter-item expanded "><a href="cli/config.html"><strong aria-hidden="true">6.3.</strong> Config</a></li><li class="chapter-item expanded "><a href="cli/cp.html"><strong aria-hidden="true">6.4.</strong> Cp</a></li><li class="chapter-item expanded "><a href="cli/cron.html"><strong aria-hidden="true">6.5.</strong> Cron</a></li><li class="chapter-item expanded "><a href="cli/help.html"><strong aria-hidden="true">6.6.</strong> Help</a></li><li class="chapter-item expanded "><a href="cli/hist.html"><strong aria-hidden="true">6.7.</strong> Hist</a></li><li class="chapter-item expanded "><a href="cli/init.html"><strong aria-hidden="true">6.8.</strong> Init</a></li><li class="chapter-item expanded "><a href="cli/login.html"><strong aria-hidden="true">6.9.</strong> Login</a></li><li class="chapter-item expanded "><a href="cli/ls.html"><strong aria-hidden="true">6.10.</strong> Ls</a></li><li class="chapter-item expanded "><a href="cli/monit.html"><strong aria-hidden="true">6.11.</strong> Monit</a></li><li class="chapter-item expanded "><a href="cli/mv.html"><strong aria-hidden="true">6.12.</strong> Mv</a></li><li class="chapter-item expanded "><a href="cli/pull.html"><strong aria-hidden="true">6.13.</strong> Pull</a></li><li class="chapter-item expanded "><a href="cli/push.html"><strong aria-hidden="true">6.14.</strong> Push</a></li><li class="chapter-item expanded "><a href="cli/rm.html"><strong aria-hidden="true">6.15.</strong> Rm</a></li><li class="chapter-item expanded "><a href="cli/run.html"><strong aria-hidden="true">6.16.</strong> Run</a></li><li class="chapter-item expanded "><a href="cli/server.html"><strong aria-hidden="true">6.17.</strong> Server</a></li><li class="chapter-item expanded "><a href="cli/stop.html"><strong aria-hidden="true">6.18.</strong> Stop</a></li><li class="chapter-item expanded "><a href="cli/supervisor.html"><strong aria-hidden="true">6.19.</strong> Supervisor</a></li><li class="chapter-item expanded "><a href="cli/worker.html"><strong aria-hidden="true">6.20.</strong> Worker</a></li></ol></li><li class="chapter-item expanded "><a href="examples/preface.html"><strong aria-hidden="true">7.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/dotnet-pipeline.html"><strong aria-hidden="true">7.1.</strong> .NET pipeline</a></li><li class="chapter-item expanded "><a href="examples/nodejs-pipeline.html"><strong aria-hidden="true">7.2.</strong> Nodejs pipeline</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Bld book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p align="center">
    <img style="text-align: center;" height="200" width="200" src="./assets/logo.png">
</p>
<h1 id="what-is-bld"><a class="header" href="#what-is-bld">What is Bld</a></h1>
<p>Bld is a CI/CD tool that targets to build pipelines both in a local environment and in a server.</p>
<h1 id="building"><a class="header" href="#building">Building</a></h1>
<p>Bld is built using the Rust programming language so you will need a <a href="https://www.rust-lang.org/tools/install">Rust installation</a> in order to compile it.</p>
<h3 id="external-dependencies"><a class="header" href="#external-dependencies">External dependencies</a></h3>
<p>Additionally the project requires some external dependencies:</p>
<ul>
<li>build-essential</li>
<li>pkg-config</li>
<li>libssl-dev</li>
<li>libsqlite3-dev</li>
<li>(optional) docker</li>
<li>(optional) trunk (for the server UI)</li>
<li>(optional) nodejs (for the server UI)</li>
</ul>
<blockquote>
<p>The package names are for Debian based distributions, install the appropriate packages on your distribution of choice.</p>
</blockquote>
<h3 id="build-instructions"><a class="header" href="#build-instructions">Build instructions</a></h3>
<p>Once you have installed all of the above, you can build the project as follows</p>
<pre><code class="language-bash">$ git clone https://github.com/Kani-Maki-Gang/bld.git
$ cd bld
$ cargo build --release
$ ./target/release/bld --version
</code></pre>
<blockquote>
<p>The bld_server crate requires for a <code>static_files</code> directory to exist in its project structure and if it doesn't build error will appear since it tries to embed all of its files to the resulting binary. There is a <code>build.rs</code> file for the project that creates the directory but if you encounter any issues, create the directory manually.</p>
</blockquote>
<p>Bld also has a UI for its server that you can build it by running the below command</p>
<pre><code class="language-bash">$ cd crates/bld_ui
$ trunk build
</code></pre>
<blockquote>
<p>Remember to have the trunk and nodejs installed in order to build the UI.</p>
</blockquote>
<h3 id="musl-and-mingw-builds"><a class="header" href="#musl-and-mingw-builds">Musl and Mingw builds</a></h3>
<p>Since there are multiple dependencies deployment of bld can be difficult, so the project supports targeting musl for static linking in Unix like operating systems while supports mingw for Windows. If you have an existing bld binary locally built/installed then follow the below instructions. This steps require a docker, podman or other container engine installed.</p>
<pre><code class="language-bash">$ bld run -p pipelines/build.yaml
$ ls dist
</code></pre>
<p>Or you can use cargo to built bld for your system and then run the pipelines for the musl build</p>
<pre><code class="language-bash">$ cargo run -- run -p pipelines/build.yaml
$ ls dist
</code></pre>
<p>With the above a new container will be built with all the necessary dependencies for building the project and the bld pipeline will clone the repository, build the binary and the copy it in the dist directory.</p>
<p>If a bld binary is not available, you will have to start a container with the bld-image and do the steps manually.</p>
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>For a prebuilt version of bld go to the github <a href="https://github.com/Kani-Maki-Gang/bld/releases">releases</a> page and download the latest version.</p>
<h1 id="creating-a-project"><a class="header" href="#creating-a-project">Creating a project</a></h1>
<p>If you have followed the above Building section and have a Bld binary available, you can execute the below commands to initialize a Bld directory.</p>
<pre><code class="language-bash">$ bld init
</code></pre>
<p>This will create a <code>.bld</code> directory with 2 files</p>
<ul>
<li><code>config.yaml</code> Which contains the configuration for the current directory</li>
<li><code>default.yaml</code> The default pipeline which simply echos a 'hello world'</li>
</ul>
<p>To test out the default pipeline simply execute</p>
<pre><code class="language-bash">$ bld run -p default.yaml
</code></pre>
<p>The pipeline will execute on your machine, but it can be changed to target a docker container. Below is the same default pipeline but having the <code>runs-on</code> section changed to target an <code>ubuntu</code> docker image, just make sure it is installed.</p>
<pre><code class="language-yaml">runs_on: ubuntu
version: 2
jobs:
  main:
  - echo 'hello world'
</code></pre>
<h1 id="creating-pipelines"><a class="header" href="#creating-pipelines">Creating pipelines</a></h1>
<p>In order to make new pipelines, you just need to create a yaml file under the <code>.bld</code> directory. For better structure you can add pipelines in directories and give the relative path to bld.</p>
<p>For example given a sample project you might want to have a build and deploy pipelines, the structure could be done as</p>
<pre><code>.bld
 |    config.yaml
 |    default.yaml
 └─── sample
      |    build.yaml
      |    deploy.yaml
</code></pre>
<p>And the pipelines can be run with their relative path inside the <code>.bld</code> directory.</p>
<pre><code class="language-bash">$ bld run -p sample/build.yaml
$ bld run -p sample/deploy.yaml
</code></pre>
<h1 id="quick-pipeline-example"><a class="header" href="#quick-pipeline-example">Quick pipeline example</a></h1>
<p>If you want a quick example of how a more involed pipeline would look, lets take the below example that tries to build a .net project and also run static analysis that will be sent to a sonar qube instance.</p>
<p>This is the example pipeline that runs the scanner called <code>example-project/scanner.yaml</code></p>
<pre><code class="language-yaml">name: Example .net project sonar scanner pipeline
version: 2
runs_on:
  dockerfile: /path/to/custom-dockerfile-for-scanner
  tag: latest
  name: scanner

variables:
  branch: master
  key: ExampleProject
  url: http://some-url-for-sonar-qube
  login: some_login_token

jobs:
  main:
  - git clone ${{branch}} https://some-url-for-the-repository
  - working_dir: /example-project/src
    exec:
    - dotnet sonarscanner begin /k:"${{key}}" /d:sonar.host.url=${{url}} /d:sonar.login="${{login}}"
    - dotnet build
    - dotnet sonarscanner end /d:sonar.login="${{login}}"
</code></pre>
<p>This is the example pipeline that builds the release version of the project called <code>example-project/build.yaml</code></p>
<pre><code class="language-yaml">name: Example project build pipeline
version: 2
runs_on:
  image: mcr.microsoft.com/dotnet/sdk:6.0-focal
  pull: true

variables:
  branch: master
  config: release

artifacts:
- method: get
  from: /example-project/src/ExampleProject/bin/${{config}}/net6.0/linux-x64
  to: /some/local/path/example-project/${{bld_run_id}}
  after: main

jobs:
  main:
  - git clone -b ${{branch}} https://some-url-for-the-repository
  - cd /example-project/src/ExampleProject &amp;&amp; dotnet build -c ${{config}}
</code></pre>
<p>This is the example pipeline called <code>example-project/deploy.yaml</code> that runs on the host machine that initiates both pipelines in parallel and also makes a simple deployment of the release build.</p>
<pre><code class="language-yaml">name: Example project deployment pipeline
version: 2
runs_on: machine

variables:
  branch: master

external:
- pipeline: example-project/sonar.yaml
  variables:
    branch: ${{branch}}

- pipeline: example-project/build.yaml
  variables:
    branch: ${{branch}}

jobs:
  scanner:
  - ext: example-project/scanner.yaml

  build_and_deploy:
  - ext: example-project/build.yaml
  - scp -r /some/local/path/example-project/${{bld_run_id}} user@some-ip:/some/path/to/the/server
</code></pre>
<blockquote>
<p>In the above the scanner pipeline runs parallel to the build and deploy since they are set in 2 different jobs. If everything should be run sequentially then the call to the scanner pipeline could be added to the same job as the other steps.</p>
</blockquote>
<h1 id="graceful-shutdown"><a class="header" href="#graceful-shutdown">Graceful shutdown</a></h1>
<p>Since each run could create and run container as well as issue remote runs to bld servers, the cli handles the SIGINT and SIGTERM signals in order to properly cleanup all of the external components. To be noted that the stop command which stops a pipeline running on a server, can be used for a graceful early shutdown of a pipeline.</p>
<h1 id="gihub-action"><a class="header" href="#gihub-action">Gihub action</a></h1>
<p>Bld has an alpha version of a github action called <a href="https://github.com/marketplace/actions/bld-action">bld-action</a> and you can access the repository <a href="https://github.com/Kani-Maki-Gang/bld-github-action">here</a>.</p>
<p>The action will look inside a repository to find the <code>.bld</code> directory in order to run the bld binary. An example that runs a pipeline with one variable is shown below:</p>
<pre><code class="language-yaml">name: Demo workflow

on:
  push:
    branches: ["main"]

jobs:
  build_musl:
    runs-on: ubuntu-latest
    name: Run demo
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Run pipeline
        uses: Kani-Maki-Gang/bld-github-action@v0.2.1-alpha
        with:
          pipeline: 'demo_pipeline.yaml'
          variables: |-
            branch=main
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-configure-bld"><a class="header" href="#how-to-configure-bld">How to configure bld</a></h1>
<p>You can edit the <code>config.yaml</code> file inside a <code>.bld</code> directory in order to configure both local options and add new target bld servers.</p>
<h1 id="local-configuration"><a class="header" href="#local-configuration">Local configuration</a></h1>
<p>The <code>local</code> section of the configuration has the below options available
ability mode.</p>
<ul>
<li>
<p><strong>docker_url</strong>: The url with which a connection will be established to the docker engine API. This can be either a single url or multiple urls, defined with a name and the ability to set a default.</p>
</li>
<li>
<p><strong>server</strong>: The start of the server section with the below options</p>
<ul>
<li><strong>host</strong>: The host that the server will be exposed to.</li>
<li><strong>port</strong>: The port that the server will be exposed to.</li>
<li><strong>tls</strong>: The start of the tls section with the below options
<ul>
<li><strong>cert_chain</strong>: The path to a certificate file.</li>
<li><strong>private_key</strong>: The path to the private key for the above certificate.</li>
</ul>
</li>
<li><strong>pipelines</strong>: A path to a directory in which the server will store registered pipelines.</li>
<li><strong>auth</strong>: The authentication section for the server.
<ul>
<li><strong>method</strong>: A text option that for the current release only accepts the value oidc.</li>
<li><strong>issuer_url</strong>: The issuer url for the authorization provider.</li>
<li><strong>redirect_url</strong>: The redirect url of the bld server.</li>
<li><strong>client_id</strong>: The client id configured in the oidc provider for the bld server.</li>
<li><strong>client_secret</strong>: The client secret for the bld server.</li>
<li><strong>scopes</strong>: An array of scopes provided when logging in.</li>
<li><strong>user_property</strong>: The property that a user will be associated with. Accepts the values name or email.</li>
</ul>
</li>
<li><strong>logs</strong>: A path to a directory where the logs for each server run will be stored.</li>
<li><strong>db</strong>: The database connection url for <code>postgres</code>, <code>mysql</code> or <code>sqlite</code>.</li>
</ul>
</li>
<li>
<p><strong>supervisor</strong>: The start of the supervisor section</p>
<ul>
<li><strong>host</strong>: The host that the supervisor will be exposed to.</li>
<li><strong>port</strong>: The port that the supervisor will be exposed to.</li>
<li><strong>tls</strong>: The start of the tls section with the below options
<ul>
<li><strong>cert_chain</strong>: The path to a certificate file.</li>
<li><strong>private_key</strong>: The path to the private key of the above certificate.</li>
</ul>
</li>
<li><strong>workers</strong>: A number that indicates how many worker processes can the supervisor spawn. This will be the maximum number of active pipeline runs on a server, with all other being queued.</li>
</ul>
</li>
<li>
<p><strong>editor</strong>: The name or path to your editor of choice for editing a pipeline through the bld cli.</p>
</li>
<li>
<p><strong>ssh</strong>: The ssh global configuration that pipelines can use to establish an ssh connection.</p>
</li>
<li>
<p><strong>registries</strong> <code>new to v0.4.x</code>: A section to define properties about available registries and credentials to access them if they are private.</p>
<ul>
<li><strong>url</strong>: The url of the registry.</li>
<li><strong>username</strong> <code>optional</code>: The username to access the registry.</li>
<li><strong>password</strong> <code>optional</code>: The password to access the registry.</li>
</ul>
</li>
</ul>
<h1 id="remote-configuration"><a class="header" href="#remote-configuration">Remote configuration</a></h1>
<p>The <code>remote</code> section of the config file is an array of servers that can be targeted. The available options are below.</p>
<ul>
<li><strong>server</strong>: The name used to target this entry.</li>
<li><strong>host</strong>: The host address of the server.</li>
<li><strong>port</strong>: The port of the server.</li>
<li><strong>tls</strong>: A boolean indicating to use secure protocols when connecting to the server.</li>
</ul>
<h1 id="putting-it-all-together"><a class="header" href="#putting-it-all-together">Putting it all together</a></h1>
<p>Below is an example configuration with all of the above options</p>
<pre><code class="language-yaml">local:
  server:
     host: localhost
     port: 6080
     tls:
        cert_chain: path/to/server_certificate.crt
        private_key: path/to/server_private.key
     auth:
        method: oidc
        issuer_url: https://some_issuer_url
        redirect_url: https://localhost:6080/authRedirect
        client_id: some_client_id
        client_secret: some_client_secret
        scopes: ["scope1", "scope2"]
        user_property: email
     pipelines: .bld/server_pipelines
     logs: .bld/logs
     db: sqlite:///path/to/project/.bld/db/bld-server.db
  supervisor:
     host: localhost
     port: 7080
     tls:
        cert_chain: path/to/supervisor_certificate.crt
        private_key: path/to/supervisor_private.key
     workers: 50
  # Using a single docker url
  # docker_url: unix:///var/run/docker.sock
  # Multiple docker urls
  docker_url:
    unix:
        url: unix:///var/run/docker.sock
        default: true
    tcp: tcp://127.0.0.1:2376
  editor: vim
  ssh:
     test_server_1:
         host: 192.168.122.3
         user: test_user
         userauth:
             type: keys
             public_key: /path/to/public_key
             private_key: /path/to/private_key
     test_server_2:
         host: 192.168.122.4
         user: test_user_2
         userauth:
             type: password
             password: some_password
     test_server_3:
         host: 192.168.122.5
         user: test_user_3
         userauth:
             type: agent
  registries:
    docker_io:
        url: https://docker.io
    ghcr:
        url: https://ghcr.io
        username: some_username
        password: some_password

remote:
- server: local_1
  host: 127.0.0.1
  port: 6080
  tls: true
- server: local_2
  host: 127.0.0.1
  port: 8080
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pipeline-syntax"><a class="header" href="#pipeline-syntax">Pipeline syntax</a></h1>
<p>Bld pipelines are built with backwards compatibility in mind, meaning that after a bld update existing pipelines will not break even if new functionality is introduced or the pipeline changes all together.</p>
<p>This is achived through a version number that is seperate from the release version of bld. When a breaking change is introduced in the pipeline syntax, in order to support new features, a pipeline version bump will happen thus all existing pipelines will execute with the set of features they were designed and will not break. This is done to let the user migrate to a new pipeline syntax at their leasure.</p>
<p>The current pipeline versions are</p>
<ul>
<li>Version 1</li>
<li>Version 2 <code>latest</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="version"><a class="header" href="#version">Version</a></h1>
<p>The <code>version</code> field is a mandatory field that indicates which specific features are available to a pipeline. A new pipeline version is created when a breaking change must be done in the pipeline yaml structure for a specific feature to be supported. Additionally each version has a dedicated runner which means that a new version of bld will execute the existing pipelines as before.</p>
<p>An example of defining a version is below.</p>
<pre><code class="language-yaml">version: 2
</code></pre>
<p>Pipeline versions are independent of the bld version, since the pipeline execution or structure might not change at all between releases.</p>
<p>The current available versions and features are listed below.</p>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>Version 1</th><th>Version 2</th></tr></thead><tbody>
<tr><td>Execute commands on host machine</td><td><span style="color:lightgreen">Yes</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Execute commands on an existing container image</td><td><span style="color:lightgreen">Yes</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Execute commands on a container image that can be pulled if not found</td><td><span style="color:red">No</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Execute commands on a container image that is built directly through a Dockerfile</td><td><span style="color:red">No</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Execute commands on a server with an ssh connection</td><td><span style="color:red">No</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Run parallel jobs</td><td><span style="color:red">No</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Support for variables</td><td><span style="color:lightgreen">Yes</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Support for environment variables</td><td><span style="color:lightgreen">Yes</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Call child pipelines with the ability to provide variables and environment variables</td><td><span style="color:lightgreen">Yes</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
<tr><td>Prevent disposal of platform at the end of a run</td><td><span style="color:lightgreen">Yes</span></td><td><span style="color:lightgreen">Yes</span></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="name"><a class="header" href="#name">Name</a></h1>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>The <code>name</code> field is optional and simply will print out the defined value at the start of the pipeline's execution. An example usage is below:</p>
<pre><code class="language-yaml">name: An example pipeline name
</code></pre>
<blockquote>
<p>Note: The name field supports expressions so a variable, an environment variable or a keyword can be used.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runs_on"><a class="header" href="#runs_on">Runs_on</a></h1>
<p>The <code>runs_on</code> field in the pipeline defines the platform of execution and currently the latest version of the pipeline syntax supports the below:</p>
<ul>
<li>machine</li>
<li>container</li>
<li>ssh connection</li>
</ul>
<h2 id="machine-platform"><a class="header" href="#machine-platform">Machine platform</a></h2>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>The machine platform indicates that all commands will be executed directly on the host machine. The bld runtime will also create a temporary directory in <code>.bld/tmp</code> path with a unique Uuid as a directory that can be used for the run which will be cleaned up afterwards.</p>
<p>To use the machine platform simply use the below top level statement.</p>
<pre><code class="language-yaml">runs_on: machine
</code></pre>
<h2 id="container-platform"><a class="header" href="#container-platform">Container platform</a></h2>
<p>The container platform is used so that commands defined in the pipeline are executed inside a docker container using an exec instance. The container platform supports various types of configuration.</p>
<h3 id="run-commands-on-existing-docker-images"><a class="header" href="#run-commands-on-existing-docker-images">Run commands on existing docker images</a></h3>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>To run commands on existing docker images. This option simply will try to create a new container at the start of the run based on the name of the provided image, if the image doesn't exist then the container won't be created. The user is responsible for maintaining the docker images in this case. As an example below we define this type of container platform for the latest ubuntu image.</p>
<pre><code class="language-yaml">runs_on: ubuntu
</code></pre>
<h3 id="run-commands-on-existing-or-missing-docker-images"><a class="header" href="#run-commands-on-existing-or-missing-docker-images">Run commands on existing or missing docker images</a></h3>
<blockquote>
<p>Supported in pipeline versions: <code>version 2</code></p>
</blockquote>
<p>This type of the container platform is similar to the previous one but it can define the option to pull the docker image when the run starts. If the pull option is active then the run will look up the image, pull it if neccessary and then start the run on the created container. As an example to define such platform for the ubuntu image you can use the below top level statement.</p>
<pre><code class="language-yaml">runs_on:
    image: ubuntu
    pull: true
</code></pre>
<p>To pull a specific image tag you can use the : notation similar to the example below.</p>
<pre><code class="language-yaml">runs_on:
    image: ubuntu:20.04
    pull: true
</code></pre>
<p>Optionally you can specify the docker url to be used for the pull operation based on the defined urls in the bld configuration file. Remember that the docker url is the name of the target url.</p>
<pre><code class="language-yaml">runs_on:
    image: ubuntu:20.04
    pull: true
    docker_url: unix_socket_docker_url
</code></pre>
<p>Last but not least you can define the docker registry to be used for the pull operation based on the defined registries in the bld configuration file or by setting a specific configuration for the pipeline.</p>
<pre><code class="language-yaml"># Look up the registry in the global configuration
runs_on:
    image: ubuntu:20.04
    pull: true
    registry: ghcr

# Define the registry in the pipeline configuration
runs_on:
    image: ubuntu:20.04
    pull: true
    registry:
        url: ghcr.io
        username: some_username
        password: some_password
</code></pre>
<h3 id="run-commands-on-images-built-from-a-dockerfile"><a class="header" href="#run-commands-on-images-built-from-a-dockerfile">Run commands on images built from a Dockerfile</a></h3>
<blockquote>
<p>Supported in pipeline versions: <code>version 2</code></p>
</blockquote>
<p>This type of container platform leverages a Dockerfile to build an image based on specified configuration and then run the provided commands on a new container created with this image. As an example to create such a platform use the below top level statement.</p>
<pre><code>runs_on:
    dockerfile: /path/to/dockerfile
    name: custom-image
    tag: latest
</code></pre>
<p>Optionally you can specify the docker url to be used for the pull operation based on the defined urls in the bld configuration file. Remember that the docker url is the name of the target url.</p>
<pre><code class="language-yaml">runs_on:
    dockerfile: /path/to/dockerfile
    name: custom-image
    tag: latest
    docker_url: unix_socket_docker_url
</code></pre>
<h2 id="ssh-platform"><a class="header" href="#ssh-platform">Ssh platform</a></h2>
<blockquote>
<p>Supported in pipeline versions: <code>version 2</code></p>
</blockquote>
<p>The ssh platform exists in order to make the execution of multiple commands over an ssh connection easier. A user could always directly use the <code>ssh</code> binary in a command that is executed in a diffferent platform.</p>
<p>An example of using this platform is shown below:</p>
<pre><code class="language-yaml">runs_on:
    host: 127.0.0.1
    port: 22
    user: some_user
    userauth:
        type: password
        password: the_user_password

</code></pre>
<p>Additionally you can define a global configuration for ssh connections in the <code>.bld/config.yaml</code> file and use the name of the configuration in the <code>runs_on</code> field as show below. See the <code>Server &gt; SSH</code> section for more information on the global configuration.</p>
<pre><code class="language-yaml">runs_on:
    ssh_config: my_global_ssh_config_key
</code></pre>
<p>Note here that this platform always expects the <code>host</code>, <code>user</code> and <code>userauth</code> fields with the <code>port</code> field being optional having a default value of <code>port: 22</code> if not provided. Additionally the <code>userauth</code> field has 3 types of authentication that can be defined.</p>
<h3 id="password-user-authentication"><a class="header" href="#password-user-authentication">Password user authentication</a></h3>
<p>The password authentication type for the ssh platform uses a password directly that is passed to the ssh connection when that is established. To define such user authentication you can use the below statement:</p>
<pre><code class="language-yaml">userauth:
    type: password
    password: the_user_password
</code></pre>
<h3 id="keys-user-authentication"><a class="header" href="#keys-user-authentication">Keys user authentication</a></h3>
<p>The keys authentication type uses a private and a public key when establishing the ssh connection, and such a configuration can be done using the below statement:</p>
<pre><code class="language-yaml">userauth:
    type: keys
    public_key: /path/to/public_key
    private_key: /path/to/private_key
</code></pre>
<p>The <code>private_key</code> field is mandatory but the <code>public_key</code> is optional.</p>
<h3 id="agent-user-authentication"><a class="header" href="#agent-user-authentication">Agent user authentication</a></h3>
<p>This type attemps to perform ssh agent authentication and can be configured using the below statement:</p>
<pre><code class="language-yaml">userauth:
    type: agent
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cron"><a class="header" href="#cron">Cron</a></h1>
<blockquote>
<p>Supported in pipeline versions: <code>version 2</code></p>
</blockquote>
<p>The <code>cron</code> field is optional and can configure the execution of a pipeline in a schedule that is defined using the cron syntax.</p>
<p>This field is only supported for server runs and doesn't affect local runs. Additionally it will set up a scheduled execution with the default values for variables and environment variables, if a more parameterized scheduled job is required please visit the <code>cron</code> cli subcommand.</p>
<p>An example use case it would be to execute a pipeline every 10 seconds</p>
<pre><code class="language-yaml">cron: 10 * * * * * *
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dispose"><a class="header" href="#dispose">Dispose</a></h1>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>The dispose field is optional and when set to true, it wont clean up after a pipeline run.</p>
<p>Specifically</p>
<ul>
<li>For the machine platform the temporary directory that is created under the <code>.bld/tmp/</code> path with a Uuid directory for the run, won't be deleted.</li>
<li>For the container platform the container itself won't be stopped and removed.</li>
<li>Dispose is ignored for the <code>ssh</code> platform, since the ssh connection will close once the run finishes.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="variables"><a class="header" href="#variables">Variables</a></h1>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code>.
<br /> The syntax between the pipeline versions differ so all examples will be presented for both.</p>
</blockquote>
<p>The variables section is a hashmap where the key is the variable name and the value is its default value. The value of a variable can be modified by the user when running the pipeline.</p>
<p>Based on the first example, that was rather specific, we could enhance our pipeline with a variable to either list the content of the target_directory or another one specified when using the <code>run</code> subcommand. Below is a configured pipeline with a variable</p>
<p><strong>version 1</strong></p>
<pre><code class="language-yaml">name: Example pipeline with variables 1
runs_on: machine
version: 1

variables:
  directory: /home/user/target_directory

steps:
- name: List all content of target_directory
  exec:
  - ls bld:var:directory
</code></pre>
<p><strong>version 2</strong></p>
<pre><code class="language-yaml">name: Example pipeline with variables 1
runs_on: machine
version: 2

variables:
  directory: /home/user/target_directory

jobs:
  main:
  - ls ${{directory}}
</code></pre>
<p>Here we see the syntax for using a Bld variable, configuring its name and default value. It can be used with the format <code>bld:var:directory</code> for version 1 and <code>${{directory}}</code> for version 2. You can run the pipeline normally and leave the value as is or you can use the <code>-v</code> or <code>--variable</code> option of the <code>run</code> subcommand</p>
<pre><code class="language-bash">$ bld run -p example.yaml -v directory=/home/kvl/another_directory
</code></pre>
<p>We can define multiple variables</p>
<p><strong>version 1</strong></p>
<pre><code class="language-yaml">name: Example pipeline with variables 2
runs_on: machine
version: 1

variables:
  first_directory: /home/user/target_directory
  second_directory: /home/user/another_directory
  third_directory: /home/user/yet_another_directory

steps:
- name: List content of all directories
  exec:
  - ls bld:var:first_directory
  - ls bld:var:second_directory
  - ls bld:var:third_directory
</code></pre>
<p><strong>version 2</strong></p>
<pre><code class="language-yaml">name: Example pipeline with variables 2
runs_on: machine
version: 2

variables:
  first_directory: /home/user/target_directory
  second_directory: /home/user/another_directory
  third_directory: /home/user/yet_another_directory

jobs:
  main:
  - ls ${{first_directory}}
  - ls ${{second_directory}}
  - ls ${{third_directory}}
</code></pre>
<p>And set new values using the cli</p>
<pre><code class="language-bash">$ bld run -p example.yaml -v first_directory=some_path -v second_directory=some_other_path -v third_directory=some_yet_another_path
</code></pre>
<blockquote>
<p>Note: The variable fields support expressions so a variable, an environment variable or a keyword can be used as a variable's default value.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-variables"><a class="header" href="#environment-variables">Environment variables</a></h1>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code>.
<br /> The syntax between the pipeline versions differ so all examples will be presented for both.</p>
</blockquote>
<p>Same with the variables section, the environment variables section is a hashmap where the key is the variable name and the value is its default value. The value of an environment variable can be modified the user when running the pipeline.</p>
<p>Just like with variables, they can be used with the same format as a variable with the <code>bld:env:</code> prefix for version 1 and the <code>${{ ... }}</code> syntax for version 2.</p>
<p><strong>version 1</strong></p>
<pre><code class="language-yaml">name: Example pipeline with environment variables 1
runs_on: machine
version: 1

environment:
  first_directory: /home/user/target_directory
  second_directory: /home/user/another_directory

steps:
- name: List content of all directories
  exec:
  - ls bld:env:first_directory
  - ls $second_directory
</code></pre>
<p><strong>version 2</strong></p>
<pre><code class="language-yaml">name: Example pipeline with environment variables 1
runs_on: machine
version: 2

environment:
  first_directory: /home/user/target_directory
  second_directory: /home/user/another_directory

jobs:
  main:
  - name: List content of all directories
    exec:
    - ls ${{first_directory}}
    - ls $second_directory
</code></pre>
<p>And specify a different value using the <code>-e</code> or <code>--environment</code> of the <code>run</code> subcommand</p>
<pre><code class="language-bash">$ bld run -p example.yaml -e first_directory=some_path -e second_directory=some_other_path
</code></pre>
<blockquote>
<p>Note: The environment variable fields support expressions so a variable, an environment variable or a keyword can be used as a environment variable's default value.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="keywords"><a class="header" href="#keywords">Keywords</a></h1>
<blockquote>
<p>Supported for pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>This isn't related to any field available to the pipeline syntax but more regarding the expressions. Bld has some built in keywords for specific information about a run, those are</p>
<h3 id="version-1"><a class="header" href="#version-1">Version 1</a></h3>
<p>All of the below keywords are used with the <code>bld:run:</code> prefix.</p>
<ul>
<li><strong>root_dir</strong> : This is the path to the .bld directory of the project.</li>
<li><strong>id</strong>: This is the unique uuid for the pipeline run.</li>
<li><strong>start_time</strong>: The start time of the pipeline run.</li>
</ul>
<pre><code class="language-yaml">version: 1
runs_on: machine

steps:
    - exec:
      - echo bld:run:root_dir
      - echo bld:run:id
      - echo bld:run:start_time
</code></pre>
<h3 id="version-2"><a class="header" href="#version-2">Version 2</a></h3>
<p>All of the below keywords are used inside the <code>${{ ... }}</code> syntax.</p>
<ul>
<li><strong>bld_root_dir</strong>: This is the path to the .bld directory of the project.</li>
<li><strong>bld_project_dir</strong>: This is the path to the current project directory, that is the parent of the .bld directory.</li>
<li><strong>bld_run_id</strong>: This is the unique uuid for the pipeline run.</li>
<li><strong>bld_start_time</strong>: The start time of the pipeline run.</li>
</ul>
<pre><code class="language-yaml">version: 2
runs_on: machine

jobs:
    main:
      - echo ${{bld_root_dir}}
      - echo ${{bld_project_dir}}
      - echo ${{bld_run_id}}
      - echo ${{bld_start_time}}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="artifacts"><a class="header" href="#artifacts">Artifacts</a></h1>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>This section can be used to send or fetch files to or from a container created by a run. For example let say we create a pipeline that will create a file in an <code>ubuntu</code> container and then fetch it on the current machine.</p>
<pre><code class="language-yaml">name: Example pipeline for artifacts
runs_on: ubuntu
version: 2

artifacts:
- method: get
  from: /sample_file
  to: /home/user/some_directory
  after: main

jobs:
  main:
  - echo 'hello world' &gt; sample_file
</code></pre>
<p>The artifacts section supports methods <code>get</code> to retrieve files and <code>push</code> to send files to the container. The <code>after</code> field can specify a step instead of a job or it can be omitted in order for the operation to execute before any job or step.</p>
<pre><code class="language-yaml">name: Example pipeline for artifacts
runs_on: ubuntu
version: 2

artifacts:
- method: get
  from: /sample_file
  to: /home/user/some_directory
  after: Echo step

jobs:
  main:
  - name: Echo step
    exec:
    - echo 'hello world' &gt; sample_file
  - name: Another echo step
    exec:
    - echo 'hello again'
</code></pre>
<blockquote>
<p>Note: The artifacts section support expressions so a variable, an environment variable or a keyword can be used in the <code>from</code>, <code>to</code> and <code>after</code> fields.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="external"><a class="header" href="#external">External</a></h1>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>The <code>external</code> section can used to declare information about another pipeline (either local or on a remote server) and be invoked by jobs.</p>
<p>Lets see all 3 ways that an external pipeline can be called. The first way is to simply call it in the exec part of a step.</p>
<pre><code class="language-yaml">runs_on: ubuntu
version: 2

jobs:
  main:
  - ext: child.yaml
</code></pre>
<p>The second way is to define a new entry to the external section for the pipeline, where values for variables and environment variables can be defined.</p>
<pre><code class="language-yaml">runs_on: ubuntu
version: 2

external:
- pipeline: child.yaml
  variables:
    some-variable: an example value

jobs:
  main:
  - ext: child.yaml
</code></pre>
<p>The third way is to use a name in the external entries which can even have the same pipelines but with different declarations.</p>
<pre><code class="language-yaml">runs_on: ubuntu
version: 2

variables:
  some-variable: an examples value

external:
- name: Call child.yaml with a variable
  pipeline: child.yaml
  variables:
    some-variable: ${{some-variable}}

- name: Call child.yaml on a server
  pipeline: child.yaml
  server: demo_server
  variables:
    some-variable: an example value

- name: Call child-2.yaml on a server
  pipeline: child-2.yaml
  server: demo_server

jobs:
  main:
  - ext: Call child.yaml with a variable
  - ext: Call child.yaml on a server
  - ext: Call child-2.yaml on a server
</code></pre>
<p>As seen above in the external section you can define a server in order to invoke the child pipeline to a Bld server. For example let see the below example that invokes a pipeline to a server called <code>demo</code>.</p>
<pre><code class="language-yaml">pipeline: Parent pipeline
runs_on: ubuntu
version: 2

external:
- pipeline: child.yaml
  server: demo

jobs:
  main:
  - name: Do execute child
    exec:
    - ext: child.yaml
</code></pre>
<p>Additionally as you will already have figured out you can pass both variables and environment variables to the target pipeline. See the below example for configuring them.</p>
<pre><code class="language-yaml">external:
- name: Execute child pipeline
  pipeline: child.yaml
  variables:
  - variable1: hello
  - variable2: ${{some_variable}}
  environment:
  - env1: hello world
</code></pre>
<blockquote>
<p>Note: The external section support expressions so a variable, an environment variable or a keyword can be used in the <code>name</code>, <code>server</code>, <code>pipeline</code>, <code>variables</code> and <code>environment</code> fields.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="jobs-and-steps"><a class="header" href="#jobs-and-steps">Jobs and steps</a></h1>
<blockquote>
<p>Jobs are supported in pipeline versions: <code>version 2</code>
<br />Steps are supported in pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>The <code>jobs</code> section describes a set of parallel commands to be executed or external pipelines to be invoked. All jobs contain a number of steps with steps having mutliple representation for the level of complexity they want to achieve.</p>
<p>In <code>version 1</code> of the pipeline syntax only steps could be defined and run sequentially, while in <code>version 2</code> jobs were introduced for parallel execution.</p>
<p>Let's take a look at an example where a <code>version 1</code> pipeline will execute some command in sequential order:</p>
<pre><code class="language-yaml">name: Example pipeline for multiple steps
runs_on: machine
version: 1

steps:
  - exec:
    - ls ./some_directory
    - ls ./some_other_directory
    - ls ./yet_another_directory

  - exec:
    - echo 'hello world' &gt; sample_file

  - exec:
    - curl ifconfig.me
</code></pre>
<p>The same example for a <code>version 2</code> pipeline that executes the command but in parallel:</p>
<pre><code class="language-yaml">name: Example pipeline
runs_on: machine
version: 2

jobs:
  list_content_of_directories:
  - ls ./some_directory
  - ls ./some_other_directory
  - ls ./yet_another_directory

  create_sample_file:
  - echo 'hello world' &gt; sample_file

  curl_ip_address:
  - curl ifconfig.me
</code></pre>
<p>If you've read the previous section for the external pipelines, you will already know that by using the <code>ext:</code> key on a step, the action taken is to invoke that pipeline, based on the external configuration (if no configuration is present the pipeline is simply run locally).</p>
<p><strong>version 1</strong></p>
<pre><code class="language-yaml">name: Example pipeline
runs_on: machine
version: 1

steps:
  - exec:
    - ext: example-pipeline-1.yaml
    - ext: example-pipeline-2.yaml
    - echo 'hello'
</code></pre>
<p><strong>version 2</strong></p>
<pre><code class="language-yaml">name: Example pipeline
runs_on: machine
version: 2

jobs:
  main:
  - ext: example-pipeline-1.yaml
  - ext: example-pipeline-2.yaml
  - echo 'hello'
</code></pre>
<p>if a step requires more refined operations such as executing many actions you can define a <code>name</code> and an <code>exec</code> list.</p>
<p><strong>version 1</strong></p>
<pre><code class="language-yaml">name: Example pipeline for multiple steps
runs_on: machine
version: 1

steps:
  - name: List the content of directories
    exec:
    - ls ./some_directory
    - ls ./some_other_directory
    - ls ./yet_another_directory

  - name: Create a sample file
    exec:
    - echo 'hello world' &gt; sample_file

  - name: Curl IP address
    exec:
    - curl ifconfig.me
</code></pre>
<p><strong>version 2</strong></p>
<pre><code class="language-yaml">name: Example pipeline for multiple steps
runs_on: machine
version: 2

jobs:
  main:
  - name: List the content of directories
    exec:
    - ls ./some_directory
    - ls ./some_other_directory
    - ls ./yet_another_directory

  - name: Create a sample file
    exec:
    - echo 'hello world' &gt; sample_file

  - name: Curl IP address
    exec:
    - curl ifconfig.me
</code></pre>
<p>A named step can also have <code>ext</code> entries as shown below</p>
<p><strong>version 1</strong></p>
<pre><code class="language-yaml">name: Example pipeline for calling another pipeline
runs_on: machine
version: 1

steps:
  - name: Call another pipeline and list a directory
    exec:
    - ext: example-1.yaml
    - ls ./some_directory
</code></pre>
<p><strong>version 2</strong></p>
<pre><code class="language-yaml">name: Example pipeline for calling another pipeline
runs_on: machine
version: 2

jobs:
  main:
  - name: Call another pipeline and list a directory
    exec:
    - ext: example-1.yaml
    - ls ./some_directory
</code></pre>
<p>You can use the <code>working_dir</code> option to change the target directory for a specific step as show below</p>
<p><strong>version 1</strong></p>
<pre><code class="language-yaml">name: Example pipeline
runs_on: ubuntu
version: 1

steps:
  - name: First step
    working_dir: /some/working/directory
    exec:
    - ls ./subdirectory
    - rm ./subdirectory/file

  - name: Second step
    working_dir: /another/working/directory
    exec:
    - ls ./some-other-dir/
</code></pre>
<p><strong>version 2</strong></p>
<pre><code class="language-yaml">name: Example pipeline
runs_on: ubuntu
version: 2

jobs:
  main:
  - name: First step
    working_dir: /some/working/directory
    exec:
    - ls ./subdirectory
    - rm ./subdirectory/file

  - name: Second step
    working_dir: /another/working/directory
    exec:
    - ls ./some-other-dir/
</code></pre>
<p>Remember that a named step can be used from an artifacts section to transfer data from or to the used platform.</p>
<blockquote>
<p>Note: The jobs section support expressions so a variable, an environment variable or a keyword can be used in all forms of a step and it's fields.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="validation"><a class="header" href="#validation">Validation</a></h1>
<blockquote>
<p>Supported in pipeline versions: <code>version 1</code>, <code>version 2</code></p>
</blockquote>
<p>Pipelines are run under a set of validation rules that target to help identify issues before the pipeline actually runs. This is the first part of a local run, but validation rules will be executed when a pipeline is pushed in a bld server instance and manually by running the <code>check</code> subcommand.</p>
<p>The validation rules differ between pipeline versions since the syntax could change drastically,  since the validation are both structural for the yaml file as well as contextual based on what features are used. Below all validation rules for each version will be presented.</p>
<h2 id="version-1-1"><a class="header" href="#version-1-1">Version 1</a></h2>
<h3 id="external-pipeline"><a class="header" href="#external-pipeline">external-&gt;pipeline</a></h3>
<ul>
<li>Checks if the pipeline file path exists.</li>
</ul>
<h3 id="external-server"><a class="header" href="#external-server">external-&gt;server</a></h3>
<ul>
<li>Checks if the server name used is found in the <code>.bld/config.yaml</code> file.</li>
</ul>
<h3 id="steps-exec-ext"><a class="header" href="#steps-exec-ext">steps-&gt;exec-&gt;ext</a></h3>
<ul>
<li>Checks if the external key is found either as a local pipeline or a defined external declaration inside the pipeline itself.</li>
</ul>
<h3 id="artifacts-after"><a class="header" href="#artifacts-after">artifacts-&gt;after`</a></h3>
<ul>
<li>Checks if the step name in the after key is found in the pipeline's steps.</li>
</ul>
<h2 id="version-2-1"><a class="header" href="#version-2-1">Version 2</a></h2>
<h3 id="runs_on-1"><a class="header" href="#runs_on-1">runs_on</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="runs_on-name"><a class="header" href="#runs_on-name">runs_on-&gt;name</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="runs_on-tag"><a class="header" href="#runs_on-tag">runs_on-&gt;tag</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="runs_on-dockerfile"><a class="header" href="#runs_on-dockerfile">runs_on-&gt;dockerfile</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>Checks if the dockerfile path is valid when no variables or keywords are used.</li>
</ul>
<h3 id="runs_on-image"><a class="header" href="#runs_on-image">runs_on-&gt;image</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="runs_on-docker_url"><a class="header" href="#runs_on-docker_url">runs_on-&gt;docker_url</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>Checks if a single url has been defined in the config file or if the name matches one of the multiple urls defined (when no variables or keywords are used).</li>
</ul>
<h3 id="runs_on-registry"><a class="header" href="#runs_on-registry">runs_on-&gt;registry</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>Checks when a key is provided if that registry key exists in the config file.</li>
</ul>
<h3 id="runs_on-ssh_config"><a class="header" href="#runs_on-ssh_config">runs_on-&gt;ssh_config</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>If no variables or keywords found then the name is checked in the <code>.bld/config.yaml</code> file in order to find if it has been defined.</li>
</ul>
<h3 id="runs_on-host"><a class="header" href="#runs_on-host">runs_on-&gt;host</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="runs_on-port"><a class="header" href="#runs_on-port">runs_on-&gt;port</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="runs_on-user"><a class="header" href="#runs_on-user">runs_on-&gt;user</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="runs_on-userauth-public_key"><a class="header" href="#runs_on-userauth-public_key">runs_on-&gt;userauth-&gt;public_key</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>If no variables or keywords are used then the path is checked if it exists.</li>
</ul>
<h3 id="runs_on-userauth-private_key"><a class="header" href="#runs_on-userauth-private_key">runs_on-&gt;userauth-&gt;private_key</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>If no variables or keywords are used then the path is checked if it exists.</li>
</ul>
<h3 id="runs_on-userauth-password"><a class="header" href="#runs_on-userauth-password">runs_on-&gt;userauth-&gt;password</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="cron-1"><a class="header" href="#cron-1">cron</a></h3>
<ul>
<li>Checks if the defined cron syntax is a valid schedule.</li>
</ul>
<h3 id="variables-1"><a class="header" href="#variables-1">variables</a></h3>
<ul>
<li>Checks all defined variables if the name is a built in keyword.</li>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="environment"><a class="header" href="#environment">environment</a></h3>
<ul>
<li>Checks all defined variables if the name is a built in keyword.</li>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="external-name"><a class="header" href="#external-name">external-&gt;name</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="external-pipeline-1"><a class="header" href="#external-pipeline-1">external-&gt;pipeline</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>Checks if the pipeline file path exists when no variables or keywords are used.</li>
</ul>
<h3 id="external-server-1"><a class="header" href="#external-server-1">external-&gt;server</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>Checks if the server name used is found in the <code>.bld/config.yaml</code> file when no variables or keywords are used when no variables or keywords are used.</li>
</ul>
<h3 id="external-variables"><a class="header" href="#external-variables">external-&gt;variables</a></h3>
<ul>
<li>Checks all defined variables if the name is a built in keyword.</li>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="external-environment"><a class="header" href="#external-environment">external-&gt;environment</a></h3>
<ul>
<li>Checks all defined variables if the name is a built in keyword.</li>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="artifacts-from"><a class="header" href="#artifacts-from">artifacts-&gt;from</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="artifacts-to"><a class="header" href="#artifacts-to">artifacts-&gt;to</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<h3 id="artifacts-after-1"><a class="header" href="#artifacts-after-1">artifacts-&gt;after</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>Checks if the step name in the after key is found in the pipeline's jobs or steps when no variables or keywords are used.</li>
</ul>
<h3 id="steps-exec-ext-1"><a class="header" href="#steps-exec-ext-1">steps-&gt;exec-&gt;ext</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
<li>Checks if the external key is found either as a local pipeline or a defined external declaration inside the pipeline itself.</li>
</ul>
<h3 id="steps-exec-working_dir"><a class="header" href="#steps-exec-working_dir">steps-&gt;exec-&gt;working_dir</a></h3>
<ul>
<li>Checks for use of variables, environment variables or keywords and if their name is defined in the pipeline.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-mode"><a class="header" href="#server-mode">Server mode</a></h1>
<p>Bld can run in server mode in order to run, push, pull, list pipelines and more. This section of the book goes into more detail on some of features of a server.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-start-a-server"><a class="header" href="#how-to-start-a-server">How to start a server</a></h1>
<p>Bld has configuration options for running in server mode. In a brand new project you can run</p>
<pre><code class="language-bash">$ bld init -s
</code></pre>
<p>To initialize a .bld directory with a <code>config.yaml</code> that has some default values. Additionally, you can use the <code>config</code> sub-command in order to print the entire configuration of your project.</p>
<p>Once the project is initialized, you can use the <code>server</code> sub-command to start bld in server mode.</p>
<pre><code class="language-bash">$ bld server
$ bld server --verbose # run with verbosity and see debug logs
</code></pre>
<h1 id="running-a-server-pipeline"><a class="header" href="#running-a-server-pipeline">Running a server pipeline</a></h1>
<p>For this section let's say that you have deployed a bld server on a VM or container and want to run a pipeline on it. To do this you need first to target that server in your project's <code>config.yaml</code> file</p>
<pre><code class="language-yaml">local:
  docker_url: tcp://127.0.0.1:2376

remote:
- server: example_server
  host: 127.0.0.1
  port: 6080
</code></pre>
<p>In the above example, we have the <code>example_server</code> in our remote config section, which is available at the defined host and port.</p>
<p>A Bld server generates and connect to a sqlite database in order to keep track of pipelines, runs and containers. This means that in order to run a pipeline on it, you need first to register it. To do this you can use the <code>push</code> sub-command. For example let's say that in a local project you have the <code>sample.yaml</code> pipeline. Execute the below to register it to the <code>example_server</code></p>
<pre><code class="language-bash">$ bld push -s example_server -p sample.yaml
</code></pre>
<p>Once pushed you can use helper sub-commands like</p>
<ul>
<li><code>list</code> to see all registered pipelines</li>
<li><code>cat</code> to see the content of a pipeline on the server</li>
<li><code>pull</code> to download a pipeline from a server</li>
<li><code>rm</code> to remove a pipeline from a server</li>
</ul>
<blockquote>
<p>For more details on each action, see the Command line interface page.</p>
</blockquote>
<p>Finnaly, to run the pipeline use the <code>run</code> sub-command and specify the target server</p>
<pre><code class="language-bash">$ bld run -s example_server -p sample.yaml
</code></pre>
<p>This will start the execution on the server side and keep a web socket connection in order to see in real time the output of the pipeline. Use the <code>--detach</code> flag to detach from the run. This will send a request to start the run and return immediately.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database"><a class="header" href="#database">Database</a></h1>
<blockquote>
<p><span style="color:red">IMPORTANT!</span> prior to the v0.3 release bld used the <code>diesel</code> crate for connecting to an <code>sqlite</code> database but from v0.3 onwards the project migrated to <code>SeaOrm</code> and now supports <code>postgres</code>, <code>mysql</code> as well as <code>sqlite</code> as a database. Due to this change projects running a server in prior versions will have issues with migrations since this was a breaking change.</p>
</blockquote>
<p>Bld supports connecting to a <code>postgres</code>, <code>mysql</code> or <code>sqlite</code> databases. To do so you need to provide an appropriate connection url in the <code>.bld/config.yaml</code> file. Below there are examples on how you can configure the url for all 3 backends.</p>
<h3 id="postgres"><a class="header" href="#postgres">Postgres</a></h3>
<pre><code class="language-yaml">local:
    server:
        db: postgres://some_user:some_password@127.0.0.1/bld-server
</code></pre>
<p>And an example using an explicit port:</p>
<pre><code class="language-yaml">local:
    server:
        db: postgres://some_user:some_password@127.0.0.1:8888/bld-server
</code></pre>
<h3 id="mysql"><a class="header" href="#mysql">Mysql</a></h3>
<pre><code class="language-yaml">local:
    server:
        db: mysql://some_user:some_password@127.0.0.1/bld-server
</code></pre>
<p>And an example using an explicit port:</p>
<pre><code class="language-yaml">local:
    server:
        db: mysql://some_user:some_password@127.0.0.1:8888/bld-server
</code></pre>
<h3 id="sqlite"><a class="header" href="#sqlite">Sqlite</a></h3>
<pre><code class="language-yaml">local:
    server:
        db: sqlite:///some/path/to/.bld/db/bld-server.db
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="authorization"><a class="header" href="#authorization">Authorization</a></h1>
<p>Server mode does not have it's own authorization method but it uses external services. The only current method is using an existing oidc provider with an example below.</p>
<h2 id="configuration-of-server-to-validate-user-using-googles-oidc"><a class="header" href="#configuration-of-server-to-validate-user-using-googles-oidc">Configuration of server to validate user using google's oidc</a></h2>
<p>The below example assumes that google authorization has been setup.</p>
<pre><code class="language-yaml">local:
  server:
    host: localhost
    port: 6080
    auth:
      method: oidc
      issuer_url: https://accounts.google.com
      redirect_url: http://localhost:6080/auth/redirect
      client_id: __the client id__
      client_secret: __the client secret__
      scopes: ["openid", "profile", "email"]
      user_property: name
  docker_url: tcp://127.0.0.1:2376
</code></pre>
<blockquote>
<p>Note: The <code>user_property</code> field will be used as the identification name for the user for various logs in the server such as run history etc. The only available values are name or email and these are retrieved from the user info url discovered from the oidc provider.</p>
</blockquote>
<h2 id="configuration-of-a-server-from-a-clients-configyaml"><a class="header" href="#configuration-of-a-server-from-a-clients-configyaml">Configuration of a server from a client's config.yaml</a></h2>
<p>This will send a request to the provided validation url in order to fetch the user info.</p>
<pre><code class="language-yaml">local:
  docker_url: tcp://127.0.0.1:2376
remote:
- server: local_server
  host: localhost
  port: 6080
</code></pre>
<h2 id="login-process"><a class="header" href="#login-process">Login process</a></h2>
<p>Use the <code>login</code> subcommand from the client this will connect to the server using a websocket that in turn will start the login operation.</p>
<pre><code class="language-bash">$ bld login -s local_server
</code></pre>
<p>Once the login process starts, a url will be sent to the client and be opened automatically in a browser instance that will point to google's login page (If opening the brower fails, the url will be printed to stdout for the user to navigate m. Once the user is authenticated, the server will receive the tokens send them to the client throught the open web socket and then the login process will finish.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tls"><a class="header" href="#tls">TLS</a></h1>
<p>Server mode can be configured to use a certificate for https and wss connections. For most cases having the server behind a battle tested reverse proxy would be best.</p>
<p>To configure the certificate see the below example</p>
<pre><code class="language-yaml">local:
    server:
        host: 127.0.0.1
        port: 6080
        tls:
            cert_chain: /path/to/server/certificate
            private_key: /path/to/server/private-key
    supervisor:
        host: 127.0.0.1
        port: 7080
        tls:
            cert_chain: /path/to/supervisor/certificate
            private_key: /path/to/supervisor/private-key

</code></pre>
<p>The certificate should be of type PEM. Setting the tls option for the supervisor means that all communications between the server and the supervisor will be done using https and wss.</p>
<p>Connecting to a server with enabled tls, the local configuration should have the option of tls set to true, as seen in the below example.</p>
<pre><code class="language-yaml">local:
    docker_url: tcp://127.0.0.1:2376
remote:
    - server: local_srv
      host: 127.0.0.1
      port: 6080
      tls: true
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssh"><a class="header" href="#ssh">SSH</a></h1>
<p>One of the supported platforms is <code>ssh</code> which lets a pipeline execute all commands using a ssh connection. This part of the book isn't neccessarily only for bld servers but for local configurations as well.</p>
<p>In the <code>.bld/config.yaml</code> file you can define a <code>ssh</code> section that accepts keys/values for a number of ssh configurations, with an example shown below:</p>
<pre><code class="language-yaml">local:
    ssh:
        test_server_1:
            host: 192.168.122.3
            user: test_user
            userauth:
                type: keys
                public_key: /path/to/public_key
                private_key: /path/to/private_key
        test_server_2:
            host: 192.168.122.4
            user: test_user_2
            userauth:
                type: password
                password: some_password
        test_server_3:
            host: 192.168.122.5
            user: test_user_3
            userauth:
                type: agent
</code></pre>
<p>And use one of the above keys in a pipeline as shown below:</p>
<pre><code class="language-yaml">version: 2
runs_on:
    ssh_config: test_server_1

jobs:
    main:
    - echo hello world
</code></pre>
<p>The <code>ssh</code> configuration is similar to the one described in the <code>Pipelines &gt; Runs on</code> section but for quick reference they will be presented here as well.</p>
<p>This configuration always expects the <code>host</code>, <code>user</code> and <code>userauth</code> fields with the <code>port</code> field being optional having a default value of <code>port: 22</code> if not provided. Additionally the <code>userauth</code> field has 3 types of authentication that can be defined.</p>
<h3 id="password-user-authentication-1"><a class="header" href="#password-user-authentication-1">Password user authentication</a></h3>
<p>The password authentication type for the ssh platform uses a password directly that is passed to the ssh connection when that is established. To define such user authentication you can use the below statement:</p>
<pre><code class="language-yaml">userauth:
    type: password
    password: the_user_password
</code></pre>
<h3 id="keys-user-authentication-1"><a class="header" href="#keys-user-authentication-1">Keys user authentication</a></h3>
<p>The keys authentication type uses a private and a public key when establishing the ssh connection, and such a configuration can be done using the below statement:</p>
<pre><code class="language-yaml">userauth:
    type: keys
    public_key: /path/to/public_key
    private_key: /path/to/private_key
</code></pre>
<p>The <code>private_key</code> field is mandatory but the <code>public_key</code> is optional.</p>
<h3 id="agent-user-authentication-1"><a class="header" href="#agent-user-authentication-1">Agent user authentication</a></h3>
<p>This type attemps to perform ssh agent authentication and can be configured using the below statement:</p>
<pre><code class="language-yaml">userauth:
    type: agent
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-interface"><a class="header" href="#user-interface">User interface</a></h1>
<p>A Bld server offer the ability to use a web interface to manage pipelines, see statistics and logs as well as manage reoccuring tasks. Some screenshots of the interface are shown below.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/dashboard.png">
</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/history.png">
</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/pipelines.png">
</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/cron.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="login-page"><a class="header" href="#login-page">Login page</a></h1>
<p>When a Bld server has been configured with an authentication method then the first page on should see when navigating to the server is the login page. The login page is a simple form with a redirect button that will initiate the authentication process. The use will be redirected to the configured authentication provider and once they have logged in they will be redirected to the home page of the Bld server UI.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/login.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dashboard-page"><a class="header" href="#dashboard-page">Dashboard page</a></h1>
<p>The dashboard page (home page) will present to the user KPIs related to pipeline runs with each displaying a specific metrics for a specific time frame.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/dashboard.png">
</p>
<h2 id="queued-pipelines"><a class="header" href="#queued-pipelines">Queued pipelines</a></h2>
<p>This KPI displays the current number of queued pipelines to run.</p>
<p align="center">
    <img style="text-align: center;" height="200" width="400" src="server/ui/../../assets/ui/dashboard_queued_pipelines.png">
</p>
<h2 id="running-pipelines"><a class="header" href="#running-pipelines">Running pipelines</a></h2>
<p>This KPI displays the current number of running pipelines with the maximum capacity of worker configured for the server.</p>
<p align="center">
    <img style="text-align: center;" height="200" width="400" src="server/ui/../../assets/ui/dashboard_running_pipelines.png">
</p>
<h2 id="finished-pipelines"><a class="header" href="#finished-pipelines">Finished pipelines</a></h2>
<p>This KPI displays the number of successfully finished pipelines in the last <em>10</em> days.</p>
<p align="center">
    <img style="text-align: center;" height="200" width="400" src="server/ui/../../assets/ui/dashboard_finished_pipelines.png">
</p>
<h2 id="faulted-pipelines"><a class="header" href="#faulted-pipelines">Faulted pipelines</a></h2>
<p>This KPI displays the number of faulted pipelines in the last <em>10</em> days.</p>
<p align="center">
    <img style="text-align: center;" height="200" width="400" src="server/ui/../../assets/ui/dashboard_faulted_pipelines.png">
</p>
<h2 id="total-runs-per-month"><a class="header" href="#total-runs-per-month">Total runs per month</a></h2>
<p>This KPI is a bar chart that displays the total number of runs per month in the current year.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/dashboard_total_runs_per_month.png">
</p>
<h2 id="most-runs"><a class="header" href="#most-runs">Most runs</a></h2>
<p>This KPI displays the list of users with the most runs in the last month.</p>
<p align="center">
    <img style="text-align: center;" height="300" width="500" src="server/ui/../../assets/ui/dashboard_most_runs_per_user.png">
</p>
<h2 id="successfailure-rate"><a class="header" href="#successfailure-rate">Success/Failure rate</a></h2>
<p>This KPI displays the success/failure rate of the pipelines in the last month.</p>
<p align="center">
    <img style="text-align: center;" height="180" width="800" src="server/ui/../../assets/ui/dashboard_success_failure_rate.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="history-page"><a class="header" href="#history-page">History page</a></h1>
<p>This page contains information about all pipeline runs on the server with the ability to search and filter them. Additionally by clicking their <code>Id</code> url you can see the actual logs for each run.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/history.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="monitor-page"><a class="header" href="#monitor-page">Monitor page</a></h1>
<p>You can navigate to this page by clicking in the <code>Id</code> url of a pipeline run from either the <code>History</code> page or the history table in the details page of a pipeline.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/monitor.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pipelines-page"><a class="header" href="#pipelines-page">Pipelines page</a></h1>
<p>The pipelines page displays the list of pipelines available to the server with the ability to search, filter and perform actions on them.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/pipelines.png">
</p>
<p>For each pipelines the following actions are available:</p>
<p align="center">
    <img style="text-align: center;" height="150" width="500" src="server/ui/../../assets/ui/pipelines_actions.png">
</p>
<p>Where each below is listed the action related to each one of them in the same order as they appear in the image above:</p>
<ul>
<li><code>Edit</code>: This action allows the user to edit the pipeline by navigating to its info page (as of v0.4 the ability to edit the pipelines isn't implemented so you can only inspect the information about the pipeline).</li>
<li><code>Run</code>: This action allows the user to run the pipeline by navigating to the run page.</li>
<li><code>Move (Rename)</code>: This action allows the user to move the pipelines to a different path essentially renaming it.</li>
<li><code>Copy</code>: This action allows the user to create a new copy of the pipeline to a different path.</li>
<li><code>Delete</code>: This action allows the user to delete the pipeline.</li>
</ul>
<p>Each operation triggers an action but some of them display a dialog to confirm or configure the operation.</p>
<h3 id="move-rename-action-dialog"><a class="header" href="#move-rename-action-dialog">Move (Rename) action dialog</a></h3>
<p align="center">
    <img style="text-align: center;" height="300" width="600" src="server/ui/../../assets/ui/pipelines_cut_action.png">
</p>
<h3 id="copy-action-dialog"><a class="header" href="#copy-action-dialog">Copy action dialog</a></h3>
<p align="center">
    <img style="text-align: center;" height="300" width="600" src="server/ui/../../assets/ui/pipelines_copy_action.png">
</p>
<h3 id="delete-action-dialog"><a class="header" href="#delete-action-dialog">Delete action dialog</a></h3>
<p align="center">
    <img style="text-align: center;" height="300" width="600" src="server/ui/../../assets/ui/pipelines_delete_action.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pipelines-information-page"><a class="header" href="#pipelines-information-page">Pipelines information page</a></h1>
<p>In the info page the user can see the actual pipeline file, runs and crons jobs configured. Additionally most actions available in the <code>Pipelines</code> page are also available here.</p>
<h2 id="raw-file-view"><a class="header" href="#raw-file-view">Raw file view</a></h2>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/pipelines_info_raw_file.png">
</p>
<h2 id="history-view"><a class="header" href="#history-view">History view</a></h2>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/pipelines_info_history.png">
</p>
<h2 id="cron-jobs-view"><a class="header" href="#cron-jobs-view">Cron jobs view</a></h2>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/pipelines_info_cron.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-page"><a class="header" href="#run-page">Run page</a></h1>
<p>When a user click the <code>Run</code> action they will be navigated to this page which they can configure the run's variables and then start the pipeline. Once the use clicks start they will be navigated to the <code>Monitor</code> page.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/pipelines_run.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cron-jobs-page"><a class="header" href="#cron-jobs-page">Cron jobs page</a></h1>
<p>The cron jobs page displays the list of cron jobs available to the server with the ability to search, filter and perform actions on them.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/cron.png">
</p>
<p>The available action on this page are to create a new cron job, delete an existing one or click on the <code>Id</code> url to navigate to the cron job information page.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cron-job-information-page"><a class="header" href="#cron-job-information-page">Cron job information page</a></h1>
<p>In the cron job information page the user can see the actual cron job configuration and edit. There is also an option to delete the cron job from the server.</p>
<p align="center">
    <img style="text-align: center;" height="400" width="800" src="server/ui/../../assets/ui/cron_info.png">
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="github-action"><a class="header" href="#github-action">Github action</a></h1>
<p>Bld has it's own custom github action called the <a href="https://github.com/marketplace/actions/bld-action">bld-action</a>. It's use case is to enable bld pipelines to run as part of a github workflow.</p>
<h2 id="how-to-use"><a class="header" href="#how-to-use">How to use</a></h2>
<p>This action runs under the current repository and will look for a valid bld project with a <code>.bld</code>directory. The action exposes a couple of arguments that can configure a run, and are similar to the options available to the <code>run</code> sub-command, since internally the action will invoke it to execute the pipeline. The available arguments are:</p>
<ul>
<li>pipeline: The name of the pipeline.</li>
<li>server: The name of the server configuration that exists in the <code>.bld/config.yaml</code>.</li>
<li>variables: A list of key values.</li>
<li>environment: A list of key values.</li>
</ul>
<p>Due to how the variables and environment variables are passed to the <code>run</code> sub-command you will need to use the below syntax to pass mulitple values in the workflow yaml file.</p>
<pre><code class="language-yaml">variables: |-
   var1=hello
   var2=world
</code></pre>
<h2 id="example-usage-in-the-bld-repository"><a class="header" href="#example-usage-in-the-bld-repository">Example usage in the bld repository</a></h2>
<p>The <code>build-musl.yaml</code> pipeline that is responsible for creating the musl build of Bld uses a Dockerfile defined inside of the repository's <code>.bld</code> directory and executes a build of a specified branch with the default being master.</p>
<pre><code class="language-yaml">name: Bld build pipeline for musl
version: 2
runs_on:
  name: bld-musl-builder
  dockerfile: ${{bld_root_dir}}/Dockerfile
  tag: latest

variables:
    branch: master

jobs:
  main:
  - working_dir: /usr/src
    exec:
    - echo 'Cloning repository on branch ${{branch}}'
    - git clone -b ${{branch}} https://github.com/Kani-Maki-Gang/bld.git
  - working_dir: /usr/src/bld
    exec:
    - cargo build --release --target x86_64-unknown-linux-musl

artifacts:
  - method: get
    from: /usr/src/bld/target/x86_64-unknown-linux-musl/release/bld
    to: ./dist
    after: main
</code></pre>
<p>The github workflow uses the <code>bld-action</code> to run the <code>build-musl.yaml</code> pipeline under the current branch that the workflow was run on.</p>
<pre><code class="language-yaml">name: bld main workflow

on:
  push:
    branches: ["master"]
  pull_request:
    branches: ["master"]

jobs:
  build_musl:
    runs-on: ubuntu-latest
    name: Bld musl binary
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Get branch name
        id: get_branch_name
        shell: bash
        run: echo "branch=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}" &gt;&gt; $GITHUB_OUTPUT
      - name: Run bld pipeline
        uses: Kani-Maki-Gang/bld-github-action@v0.2.1-alpha
        with:
          pipeline: 'build-musl.yaml'
          variables: |-
            branch=${{ steps.get_branch_name.outputs.branch }}
</code></pre>
<blockquote>
<p><strong>Note</strong>: The pipeline will be run using the <code>.bld/config.yaml</code> found in the repository.
<br /><strong>Note</strong>: This action is still in alpha, one limitation is that the connection to docker needs to be specifically done using its unix socket since bld can't change how docker is started under the github workflow.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-interface"><a class="header" href="#command-line-interface">Command line interface</a></h1>
<p>This section lists all available subcommands for the bld binary.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cat"><a class="header" href="#cat">Cat</a></h1>
<p>The <code>cat</code> sub-command will print the content of a pipeline on a Bld server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose              Sets the level of verbosity</li>
<li>-p, --pipeline <PIPELINE>  The name of the pipeline to print</li>
<li>-s, --server <SERVER>      The name of the server to print the pipeline from</li>
<li>-h, --help                 Print help</li>
<li>-V, --version              Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld inspect -s local_server -p example_pipeline.yaml
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="check"><a class="header" href="#check">Check</a></h1>
<p>The <code>check</code> sub-command will validate a pipeline file for errors.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose              Sets the level of verbosity</li>
<li>-p, --pipeline <PIPELINE>  Path to pipeline script [default: default.yaml]</li>
<li>-s, --server <SERVER>      The name of the server to check the pipeline from</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld check
$ bld check -s local_server -p example_pipeline.yaml
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config"><a class="header" href="#config">Config</a></h1>
<p>The <code>config</code> sub-command lists all of Bld's configuration. This will also print configuration options that you might not have set but bld will assign a default value to.</p>
<p><strong>options</strong></p>
<ul>
<li>-e, --edit     Edit the config file</li>
<li>-h, --help     Print help</li>
<li>-V, --version  Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld config
$ bld config -e # to edit the config file
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cp"><a class="header" href="#cp">Cp</a></h1>
<p>The <code>cp</code> sub-command will copy local or server pipelines.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose              Sets the level of verbosity</li>
<li>-p, --pipeline <PIPELINE>  The pipeline to copy</li>
<li>-t, --target <TARGET>      The target path</li>
<li>-s, --server <SERVER>      The name of the server to execute the copy operation</li>
<li>-h, --help                 Print help</li>
<li>-V, --version              Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld cp -p source_pipeline.yaml -t target_pipeline.yaml # Copy local pipelines
$ bld cp -p source_pipeline.yaml -t target_pipeline.yaml -s local_server # Copy server pipelines
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cron-2"><a class="header" href="#cron-2">Cron</a></h1>
<p>The <code>cron</code> subcommand provides functionality from manipulating cron jobs in a server.</p>
<p><strong>commands</strong></p>
<ul>
<li>cat     Print detailed information for a registered cron job in a server</li>
<li>add     Adds a cron job to a server</li>
<li>ls      Lists all registered cron jobs in a server</li>
<li>update  Updates a cron job to a server</li>
<li>rm      Removes a registered cron job from a server</li>
<li>help    Print this message or the help of the given subcommand(s)</li>
</ul>
<p><strong>options</strong></p>
<ul>
<li>-h, --help     Print help</li>
<li>-V, --version  Print version</li>
</ul>
<h2 id="cron-cat"><a class="header" href="#cron-cat">Cron cat</a></h2>
<p>The <code>cron cat</code> subcommand prints detailed information for a registered cron job in a server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose          Sets the level of verbosity</li>
<li>-s, --server <SERVER>  The name of the server to fetch the cron job from</li>
<li>-i, --id <ID>          The id of the target cron job</li>
<li>-h, --help             Print help</li>
<li>-V, --version          Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld cron cat -i 5592508f-507c-4224-a7af-1983c2ccb971 -s local
</code></pre>
<h2 id="cron-add"><a class="header" href="#cron-add">Cron add</a></h2>
<p>the <code>cron add</code> subcommand adds a cron job to a server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose                    Sets the level of verbosity</li>
<li>-s, --server <SERVER>            The name of the server to upsert the cron job to</li>
<li>-p, --pipeline <PIPELINE>        The name of the target pipeline</li>
<li>-S, --schedule <SCHEDULE>        The new schedule for the cron job</li>
<li>-v, --variable <VARIABLES>       Define value for a variable. Can be used multiple times</li>
<li>-e, --environment <ENVIRONMENT>  Define value for an environment variable. Can be used multiple times</li>
<li>-h, --help                       Print help</li>
<li>-V, --version                    Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld cron add -s local -p sample-pipeline.yaml -S '10 * * * * * *' -v var1=hello -v var2=world -e env1='hello world'
</code></pre>
<h2 id="cron-ls"><a class="header" href="#cron-ls">Cron ls</a></h2>
<p>The <code>cron ls</code> subcommand lists all registered cron jobs in a server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose               Sets the level of verbosity</li>
<li>-s, --server <SERVER>       The name of the server to list the cron jobs from</li>
<li>-i, --id <ID>               The id of the target cron job</li>
<li>-p, --pipeline <PIPELINE>   The pipeline name for the target cron jobs</li>
<li>-S, --schedule <SCHEDULE>   The schedule for the target cron jobs</li>
<li>-d, --default &lt;IS_DEFAULT&gt;  Fetch only the default cron jobs [possible values: true, false]</li>
<li>-l, --limit <LIMIT>         Limit the results</li>
<li>-h, --help                  Print help</li>
<li>-V, --version               Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld cron ls -s local
$ bld cron ls -s local -p sample-pipeline.yaml
$ bld cron ls -s local -p sample-pipeline.yaml -l 10
$ bld cron ls -s local -l 10 -d true
</code></pre>
<h2 id="cron-update"><a class="header" href="#cron-update">Cron update</a></h2>
<p>The <code>cron update</code> subcommand updates a cron job to a server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose                    Sets the level of verbosity</li>
<li>-s, --server <SERVER>            The name of the server to upsert the cron job to</li>
<li>-i, --id <ID>                    The id of the target cron job</li>
<li>-S, --schedule <SCHEDULE>        The new schedule for the cron job</li>
<li>-v, --variable <VARIABLES>       Define value for a variable. Can be used multiple times</li>
<li>-e, --environment <ENVIRONMENT>  Define value for an environment variable. Can be used multiple times</li>
<li>-h, --help                       Print help</li>
<li>-V, --version                    Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld cron update -s local -i 5592508f-507c-4224-a7af-1983c2ccb971 -S '10 * * * * * *' -v var1=hello -e env1=world
</code></pre>
<h2 id="cron-rm"><a class="header" href="#cron-rm">Cron rm</a></h2>
<p>The <code>cron rm</code> subcommand removes a registered cron job from a server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose           Sets the level of verbosity</li>
<li>-i, --id &lt;CRON_JOB_ID&gt;  The id of the cron job to remove</li>
<li>-s, --server <SERVER>   The name of the server to remove the cron job from</li>
<li>-h, --help              Print help</li>
<li>-V, --version           Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld cron rm -s local -i 5592508f-507c-4224-a7af-1983c2ccb971
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="help"><a class="header" href="#help">Help</a></h1>
<p>The <code>help</code> sub-command will print the general help message for the Bld command line interface or the appropriate help message for another sub-command.</p>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld help
$ bld help run
$ bld help push
$ bld help stop
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hist"><a class="header" href="#hist">Hist</a></h1>
<p>The <code>hist</code> sub-command will fetch execution history of pipelines on a Bld server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose              Sets the level of verbosity</li>
<li>-s, --server <SERVER>      The name of the server to fetch history from</li>
<li>-x, --state <STATE>        Filter the history with state. Possible values are all, initial, queued, running, finished [default: running]</li>
<li>-p, --pipeline <PIPELINE>  Filter the history with state. Possible values are all, initial, queued, running, finished</li>
<li>-l, --limit <LIMIT>        Limit the results [default: 100]</li>
<li>-h, --help                 Print help</li>
<li>-V, --version              Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld hist -s local_server
$ bld hist -s local_server -x initial
$ bld hist -s local_server -x queued
$ bld hist -s local_server -x running
$ bld hist -s local_server -x finished
$ bld hist -s local_server -x faulted
$ bld hist -s local_server -x all
$ bld hist -s local_server -x running -l 200
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="init"><a class="header" href="#init">Init</a></h1>
<p>The <code>init</code> sub-command will initialize a bld project by creating a new .bld directory.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose  Sets the level of verbosity</li>
<li>-s, --server   Initialize configuration for a bld server</li>
<li>-h, --help     Print help</li>
<li>-V, --version  Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld init
$ bld init -s
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="login"><a class="header" href="#login">Login</a></h1>
<p>The <code>login</code> sub-command initiates the authentication process to a bld server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose          Sets the level of verbosity</li>
<li>-s, --server <SERVER>  The name of the server to login into</li>
<li>-h, --help             Print help</li>
<li>-V, --version          Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld login -s local_server
$ Opening a new browser tab to start the login process.
# after authenticating from the browser.
$ Login completed successfully!
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ls"><a class="header" href="#ls">Ls</a></h1>
<p>The <code>ls</code> sub-command will list local or server pipelines.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose          Sets the level of verbosity</li>
<li>-s, --server <SERVER>  The name of the server to list pipelines from</li>
<li>-h, --help             Print help</li>
<li>-V, --version          Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld ls # To list local pipelines
$ bld ls -s local_server # To list server pipelines
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="monit"><a class="header" href="#monit">Monit</a></h1>
<p>The <code>monit</code> sub-command will connect to a Bld server and monitor the execution of a running pipeline.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose                    Sets the level of verbosity</li>
<li>-i, --pipeline-id &lt;PIPELINE_ID&gt;  The id of the pipeline to monitor. Takes precedence over pipeline</li>
<li>-p, --pipeline <PIPELINE>        The name of the pipeline of which to monitor the last run</li>
<li>-s, --server <SERVER>            The name of the server to monitor the pipeline from</li>
<li>--last                       Monitor the execution of the last invoked pipeline. Takes precedence over pipeline-id and pipeline</li>
<li>-h, --help                       Print help</li>
<li>-V, --version                    Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld monit -s local_server -p example_pipeline.yaml
$ bld monit -s local_server -i 8f0159e0-7f5c-4dc6-9b1a-70a219d85450
$ bld monit --last
$ bld monit -s local_server --last
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mv"><a class="header" href="#mv">Mv</a></h1>
<p>The <code>mv</code> sub-command will move local or server pipelines.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose              Sets the level of verbosity</li>
<li>-p, --pipeline <PIPELINE>  The pipeline to move</li>
<li>-t, --target <TARGET>      The target path</li>
<li>-s, --server <SERVER>      The name of the server to execute the move operation</li>
<li>-h, --help                 Print help</li>
<li>-V, --version              Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld mv -p source_pipeline.yaml -t target_pipeline.yaml # Move local pipelines
$ bld mv -p source_pipeline.yaml -t target_pipeline.yaml -s local_server # Move server pipelines
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pull"><a class="header" href="#pull">Pull</a></h1>
<p>The <code>pull</code> sub-command will fetch the content of a pipeline from a Bld server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose              Sets the level of verbosity</li>
<li>-p, --pipeline <PIPELINE>  The name of the bld server</li>
<li>-s, --server <SERVER>      The name of the server to pull the pipeline from</li>
<li>--ignore-deps          Do not include other pipeline dependencies</li>
<li>-h, --help                 Print help</li>
<li>-V, --version              Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld pull -s local_server -p example_pipeline.yaml
$ bld pull -s local_server -p example_pipeline.yaml --ignore-deps
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="push"><a class="header" href="#push">Push</a></h1>
<p>The <code>push</code> sub-command will push new content of a pipeline to a Bld server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose              Sets the level of verbosity</li>
<li>-p, --pipeline <PIPELINE>  The name of the pipeline to push</li>
<li>-s, --server <SERVER>      The name of the server to push changes to</li>
<li>--ignore-deps          Don't include other pipeline dependencies</li>
<li>-h, --help                 Print help</li>
<li>-V, --version              Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld push -s local_server -p example_pipeline.yaml
$ bld push -s local_server -p example_pipeline.yaml --ignore-deps
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rm"><a class="header" href="#rm">Rm</a></h1>
<p>The <code>rm</code> sub-command will remove a registered pipeline from a Bld server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose              Sets the level of verbosity</li>
<li>-s, --server <SERVER>      The name of the server to remove from</li>
<li>-p, --pipeline <PIPELINE>  The name of the pipeline</li>
<li>-h, --help                 Print help</li>
<li>-V, --version              Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld rm -p example_pipeline.yaml
$ bld rm -s local_server -p example_pipeline.yaml
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run"><a class="header" href="#run">Run</a></h1>
<p>The <code>run</code> sub-command will execute a Bld pipeline either locally or on a server.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose                    Sets the level of verbosity</li>
<li>-p, --pipeline <PIPELINE>        Path to pipeline script [default: default.yaml]</li>
<li>-s, --server <SERVER>            The name of the server to run the pipeline</li>
<li>--detach                     Detaches from the run execution (for server mode runs)</li>
<li>-v, --variable <VARIABLES>       Define value for a variable. Can be used multiple times</li>
<li>-e, --environment <ENVIRONMENT>  Define value for an environment variable. Can be used multiple times</li>
<li>-h, --help                       Print help</li>
<li>-V, --version                    Print version</li>
</ul>
<p><strong>usage</strong></p>
<pre><code class="language-bash">$ bld run -p example_pipeline.yaml
$ bld run -p example_pipeline.yaml -v variable1=some_value -v variable2=some_value -e env_variable=some_value
$ bld run -s local_server -p example_pipeline.yaml
$ bld run -s local_server -p example_pipeline.yaml -d
$ bld run -s local_server -p example_pipeline.yaml -v variable1=some_value -v variable2=some_value -e env_variable=some_value
$ bld run -s local_server -p example_pipeline.yaml -v variable1=some_value -v variable2=some_value -e env_variable=some_value -d
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server"><a class="header" href="#server">Server</a></h1>
<p>The <code>server</code> subcommand will start a Bld server instance.</p>
<p><strong>options</strong></p>
<ul>
<li>--verbose      Sets the level of verbosity</li>
<li>-H, --host <HOST>  The server's host address</li>
<li>-P, --port <PORT>  The server's port</li>
<li>-h, --help         Print help</li>
<li>-V, --version      Print version</li>
</ul>
<p><strong>usages</strong></p>
<pre><code class="language-bash">$ bld server
$ bld server -H 127.0.0.1 -P 6080
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="supervisor"><a class="header" href="#supervisor">Supervisor</a></h1>
<p>The <code>supervisor</code> sub-command is used by the Bld server and it's advised to not be used it directly.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="worker"><a class="header" href="#worker">Worker</a></h1>
<p>The <code>worker</code> sub-command will spawn a new run for a pipeline but is used internally by the bld server so it's advised not to be used directly.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="examples"><a class="header" href="#examples">Examples</a></h1>
<p>This section of the book has various examples for building and deploying project using bld pipelines.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-a-dotnet-project"><a class="header" href="#build-a-dotnet-project">Build a dotnet project</a></h1>
<p>This is an example pipeline for building a dotnet project in a container and copying the build artifacts to the host machine.</p>
<pre><code class="language-yaml">name: Example dotnet pipeline
version: 2
runs_on:
  image: mcr.microsoft.com/dotnet/sdk:6.0-focal
  pull: true

variables:
  branch: master
  config: release

artifacts:
- method: get
  from: /example_project/src/ExampleProject/bin/bld:var:CONFIG/net6.0
  to: /some/local/path
  after: main

jobs:
  main:
  - git clone -b ${{branch}} https://some-url-to-the-example-project-repository
  - name: Build project
    working_dir: /example_project
    exec:
    - dotnet build -c ${{config}}

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-a-nodejs-project"><a class="header" href="#build-a-nodejs-project">Build a nodejs project</a></h1>
<p>This is an example for building a nodejs project in a container and copying the build artifacts to the host machine.</p>
<pre><code class="language-yaml">name: Example nodejs pipeline
version: 2
runs_on:
  image: node:lts
  pull: true

variables:
  branch: master
  script: build-prod

artifacts:
- method: get
  from: /example_project/path/to/build/files
  to: /some/local/path
  after: main

jobs:
  main:
  - git clone -b ${{branch}} https://some-url-to-the-example-project-repository
  - name: Build project
    working-dir: /example_project
    exec:
    - npm install
    - npm run ${{SCRIPT}}

</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
